window.MSModule_rasterctl=new MSModule_rasterctl;
function MSModule_rasterctl(){function k(b,a,c){1==c||3==c?b.add(a,1):2==c?b.add(a,2):b.rem(a)}function l(b){b=b.idRandomLeft?[5,6,104,18,113]:[5,6,18];return b[Math.floor(Math.random()*b.length)]}this.addctl=function(b,a,c,e,d,f,h,g){a.idLookUser||(a.idLookUser=a.lastCmdAddId);"headright"==g?a.idHeadRight=d:"headleft"==g?a.idHeadLeft=d:"pupils0"==g?a.idPupils0=d:"pupils1"==g?a.idPupils1=d:"pupils2"==g?a.idPupils2=d:"pupils3"==g?a.idPupils3=d:"randomright"==g?a.idRandomRight=d:"randomleft"==g?a.idRandomLeft=
d:"random1blink"==g?a.idBlink1=d:"random2blink"==g?a.idBlink2=d:"random3blink"==g?a.idBlink3=d:"random4blink"==g?a.idBlink4=d:"random5blink"==g?a.idBlink5=d:"blink"==g&&(a.idBlink=d);if(b=a.aImg[e+d])b.setAttribute("data-x",f),b.setAttribute("data-y",h)};this.ctlaction=function(b,a,c,e,d,f,h){a.action=d;a.state="user";a.nLastBlink=0;a.nFrameBlink=0;a.stopping=!1;a.stopped=!1;a.xBtwEye=0;a.yBtwEye=0;a.nInactive=1E3;a.nLastRandom=0;a.cFollow=0;a.fakingmouse=!1;a.xTrg=0;a.yTrg=0;a.nTrg=0;a.xCur=0;a.yCur=
0;a.nCur=0;var g;a.idPupils0&&(g=a.aImg[e+a.idPupils0])&&(a.xBtwEye=parseInt(g.getAttribute("data-x"))+g.width/2,a.yBtwEye=parseInt(g.getAttribute("data-y"))+parseInt(g.getAttribute("data-cyframe"))/2);b=b.getDirObjectFromId(c);a.xMouseLast=f-parseInt(b.left)-a.xBtwEye;a.yMouseLast=h-parseInt(b.left)-a.yBtwEye};this.ctlTrack=function(b,a,c,e,d,f){var h=b.getDirObjectFromId(c);d=d-parseInt(h.left)-a.xBtwEye;f=f-parseInt(h.top)-a.yBtwEye;d!=a.xMouseLast||f!=a.yMouseLast?(a.nInactive=0,a.fakingmouse=
!1):(a.nInactive++,"user"==a.state&&45<a.nInactive&&.02>Math.random()&&(a.fakingmouse=!0,a.xMouseFake=200*Math.random()-100,-50<a.xMouseFake&&0>=a.xMouseFake&&(a.xMouseFake=-50),0<a.xMouseFake&&50>a.xMouseFake&&(a.xMouseFake=50),a.yMouseFake=200*Math.random()-100,-50<a.yMouseFake&&0>=a.xMouseFake&&(a.xMouseFake=-50),0<a.yMouseFake&&50>a.xMouseFake&&(a.xMouseFake=50),a.nInactive=0));a.xMouseLast=d;a.yMouseLast=f;a.fakingmouse&&(d=a.xMouseFake,f=a.yMouseFake);a.nLastBlink++;a.nLastRandom++;if(a.stopping)a.xTrg=
0,a.yTrg=0,a.nTrg=0;else if("eyetrack"!=a.state&&0==a.nInactive&&"eyetracker"==a.action)a.state="eyetrack",a.nTrg=0,a.nCur=0,a.xTrg=Math.round(d/10),a.yTrg=Math.round(f/20);else if("eyetrack"==a.state&&40>a.nInactive){if(h=Math.round(d/10),f=Math.round(f/20),h!=a.xTrg||f!=a.yTrg)a.xTrg=h,a.yTrg=f}else"eyetrack"==a.state&&40<=a.nInactive?(a.state="eyetrackstop",a.xTrg=0,a.yTrg=0):"randomheadattarget"==a.state&&(60<a.nLastBlink?(a.state="blink",a.nFrameBlink=1,a.nLastBlink=0):.03>Math.random()&&20<
a.nLastRandom&&(a.nTrg=l(a),a.nTrg!=a.nCur&&(a.state="randomheadmove",a.cFollow=0)));"user"==a.state&&(60<a.nLastBlink?(a.state="blink",a.nFrameBlink=1,a.nLastBlink=0):("eyetracker"==a.action||"lookuseridle"==a.action)&&.03>Math.random()&&20<a.nLastRandom&&(a.nTrg=l(b,c,e),a.cFollow=0,a.state="randomheadmove"));if(a.xCur!=a.xTrg||a.yCur!=a.yTrg){c=Math.sqrt((a.xTrg-a.xCur)*(a.xTrg-a.xCur)+(a.yTrg-a.yCur)*(a.yTrg-a.yCur));e=.4*c;1>e&&(e=c);f=2;if("eyetrackstop"==a.state||a.fakingmouse)f=.5;a.xCur=
0==c?a.xCur:Math.round(a.xCur+Math.min(f,e/c*(a.xTrg-a.xCur)));a.yCur=0==c?a.yCur:Math.round(a.yCur+Math.min(f,e/c*(a.yTrg-a.yCur)));c=a.xCur;e=a.yCur;b.rem(a.idBlink);b.rem(a.idBlink1);b.rem(a.idBlink2);b.rem(a.idBlink3);b.rem(a.idBlink4);b.rem(a.idBlink5);b.rem(a.idRandomLeft);b.rem(a.idRandomRight);-8>c&&(c=-8);8<c&&(c=8);-3>e&&(e=-3);3<e&&(e=3);0==c?(b.rem(a.idHeadRight),b.rem(a.idHeadLeft),b.add(a.idLookUser,1)):0<c?(b.rem(a.idLookUser),b.rem(a.idHeadRight),b.add(a.idHeadLeft,c)):0>c&&(b.rem(a.idLookUser),
b.rem(a.idHeadLeft),b.add(a.idHeadRight,-c));b.rem(a.idPupils0);b.rem(a.idPupils1);b.rem(a.idPupils2);b.rem(a.idPupils3);-3==e?b.add(a.idPupils3,c+9):-2==e?b.add(a.idPupils2,c+9):-1==e?b.add(a.idPupils1,c+9):0==e?b.add(a.idPupils0,c+9):1==e?b.add(a.idPupils1,17+c+9):2==e?b.add(a.idPupils2,17+c+9):3==e&&b.add(a.idPupils3,17+c+9)}if(a.nCur!=a.nTrg){a:{c=a.nCur;e=[[5,4,3,2,1,0],[6,7,8,9,0],[104,103,102,101,0],[18,22,21,20,19,0],[113,120,119,118,117,0],[0,1,2,3,4,5],[6,12,11,10,5],[104,107,106,105,5],
[18,17,16,15,14,6,12,11,10,5],[113,112,111,110,109,108,104,107,106,106,5],[0,9,8,7,6],[5,10,11,12,6],[104,103,102,101,9,8,7,6],[18,17,16,15,14,13,6],[113,116,115,114,18,17,16,15,14,13,6],[0,101,102,103,104],[5,105,106,107,104],[6,7,8,9,101,102,103,104],[18,114,115,116,113,112,111,110,109,108,104],[113,112,111,110,109,108,104],[0,19,20,21,22,18],[5,4,3,2,1,0,19,20,21,22,18],[6,13,14,15,16,17,18],[104,108,109,110,111,112,113,116,115,114,18],[113,116,115,114,18],[0,117,118,119,120,113],[5,4,3,2,1,0,
117,118,119,120,113],[6,13,14,15,16,17,18,114,115,116,113],[104,108,109,110,111,112,113],[18,114,115,116,113]];for(f=0;f<e.length;f++)if(h=e[f].length,e[f][h-1]==a.nTrg)for(d=0;d<h-1;d++)if(e[f][d]==c){c=e[f][d+1];break a}for(f=0;f<e.length;f++)for(h=e[f].length,d=0;d<h-1;d++)if(e[f][d]==c){c=e[f][d+1];break a}}a.nCur=c;c=a.nCur;b.rem(a.idBlink);b.rem(a.idBlink1);b.rem(a.idBlink2);b.rem(a.idBlink3);b.rem(a.idBlink4);b.rem(a.idBlink5);b.rem(a.idHeadLeft);b.rem(a.idHeadRight);b.rem(a.idPupils0);b.rem(a.idPupils1);
b.rem(a.idPupils2);b.rem(a.idPupils3);0==c?(b.rem(a.idRandomLeft),b.rem(a.idRandomRight),b.add(a.idLookUser,1)):100<c?(b.rem(a.idLookUser),b.rem(a.idRandomRight),b.add(a.idRandomLeft,c-100)):(b.rem(a.idLookUser),b.add(a.idRandomRight,c),b.rem(a.idRandomLeft));a.nLastRandom=0}0<a.nFrameBlink&&(c=a.nFrameBlink,0==a.nCur?k(b,a.idBlink,c):5==a.nCur?k(b,a.idBlink1,c):6==a.nCur?k(b,a.idBlink2,c):104==a.nCur?k(b,a.idBlink3,c):18==a.nCur?k(b,a.idBlink4,c):113==a.nCur&&k(b,a.idBlink5,c),a.nFrameBlink++,5==
a.nFrameBlink&&(a.state="user",a.nFrameBlink=0));a.idMsgNext&&(a.stopping=!0);a.stopping&&0==a.xCur&&0==a.yCur&&0==a.nCur&&0==a.nFrameBlink?(a.stopped=!0,a.stopping=!1,a.action="",a.fStopReached&&(a.complete=!0,b.controllerStopped())):"eyetrackstop"==a.state&&0==a.xCur&&0==a.yCur?a.state="user":"randomheadstop"==a.state&&0==a.nCur?a.state="user":"randomheadmove"==a.state&&a.nCur==a.nTrg&&(a.state="randomheadattarget",.7>Math.random()&&3>a.cFollow&&(a.nTrg=l(a),a.nTrg!=a.nCur&&(a.state="randomheadmove",
a.cFollow++)))}}msModuleLoaded();